<mat-card class="reviews-section">
  <h3>Customer Reviews ({{ (reviews$ | async)?.length || 0 }})</h3>

  @if (averageRating$ | async; as avg) {
  <div class="average-rating-display">
    <mat-icon class="large-star">star</mat-icon>
    <span class="score">{{ avg.toFixed(1) }}</span>
    <div class="rating-stats">
      <span class="max-score">out of 5</span>
      <span class="count">{{ (reviews$ | async)?.length || 0 }} global ratings</span>
    </div>
  </div>
  }

  <div class="review-list">
    @for (review of reviews$ | async; track review.id) {
    <div class="review-item">
      <div class="user-sidebar">
        <div class="user-info">
          <div class="user-avatar">{{ review.reviewerUsername?.charAt(0) }}</div>
          <span class="user-name">{{ review.reviewerUsername }}</span>
          <span class="review-date">{{ review.addedDate | date:'mediumDate' }}</span>
        </div>
      </div>

      <div class="review-body">
        <div class="review-content">
          <div class="stars-display">
            @for (i of [1, 2, 3, 4, 5]; track i) {
            <mat-icon class="star" [class.filled]="review.rating! >= i">star</mat-icon>
            }
          </div>
          <p class="review-text">"{{ review.review }}"</p>
        </div>
      </div>
    </div>
    } @empty {
    <p class="no-reviews">No reviews yet. Be the first to leave one!</p>
    }
  </div>
</mat-card>
<header class="th-header">
  <nav class="nav-container">
    <div class="logo-group">
      <a routerLink="/search" class="brand">TaskHeroes</a>
    </div>

    <div class="menu">
      @if (isLoggedIn()) {
        @if (userData$ | async; as user) {
          <a [routerLink]="getMessagesLink(user)" routerLinkActive="active-link">Messages</a>

          @if (user.role === 'provider') {
            <a [routerLink]="['/provider', user.id]" 
            routerLinkActive="active-link"
            [routerLinkActiveOptions]="{ exact: true }">Listings</a>
            <a [routerLink]="['/provider', user.id, 'jobs']" 
            routerLinkActive="active-link"
            [routerLinkActiveOptions]="{ exact: true }">Jobs</a>
          } @else {
            <a routerLink="/search" routerLinkActive="active-link">Search</a>
            <a [routerLink]="['/seeker', user.id, 'orders']" routerLinkActive="active-link">Orders</a>
          }

          <div class="nav-divider"></div>

          <button class="role-switch-btn" 
                  [class.is-provider]="user.role === 'provider'"
                  (click)="toggleRole(user)">
            <span class="icon">â‡„</span>
            Switch to {{ user.role === 'seeker' ? 'Provider' : 'Seeker' }}
          </button>

          <div class="profile-container">
            <button class="avatar-circle" (click)="toggleMenu()">
              {{ (user.username || '').charAt(0).toUpperCase() }}
            </button>
          </div>
          @if (isMenuOpen()) {
            <div class="dropdown-menu">
              <div class="dropdown-header">
                <p class="user-display-name">{{ user.username }}</p>
                <p class="user-email">{{ user.email }}</p>
              </div>

              <div class="menu-items">
                <a [routerLink]="['/user', user.id, 'profile']" (click)="isMenuOpen.set(false)" class="menu-item">
                  <span class="item-icon">ðŸ‘¤</span> Account Settings
                </a>
                
                <a [routerLink]="['/user', user.id, 'security']" (click)="isMenuOpen.set(false)" class="menu-item">
                  <span class="item-icon">ðŸ”’</span> Password & Security
                </a>

                <div class="menu-divider"></div>

                <button (click)="logout()" class="menu-item logout-item">
                  <span class="item-icon">ðŸšª</span> Logout
                </button>
              </div>
            </div>
          }
        }
      } @else {
        <div class="auth-group">
          <a routerLink="/login" routerLinkActive="active-link">Login</a>
          <a routerLink="/register" class="btn-primary" routerLinkActive="active-link">Register</a>
        </div>
      }
    </div>
  </nav>
</header>

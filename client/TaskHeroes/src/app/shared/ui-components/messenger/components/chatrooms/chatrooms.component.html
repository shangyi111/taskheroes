<div class="chatrooms-sidebar">
   @if (chatrooms().length > 0) {
    <header class="sidebar-header">
      <div class="header-content">
          <h1 class="title">Messages</h1>
          <span class="count-badge">{{ chatrooms().length }}</span>
      </div>
    </header>
  }

  <div class="list-viewport">
    @if (chatrooms().length > 0) {
      @for (chatroom of chatrooms(); track chatroom.id) {
        <div 
          class="chat-item" 
          [class.active]="activeChatId()?.toString() === chatroom.id.toString()"
          (click)="goToChatroom(chatroom)">
          
          <div class="avatar">
            {{ chatroom.name.charAt(0).toUpperCase() }}
          </div>

          <div class="content">
            <div class="top-row">
              <span class="name">{{ getChatPartnerName(chatroom,this.user()?.id) }}</span>
              <span class="job-id">#{{ chatroom.jobId }}</span>
            </div>
            <p class="preview">{{chatroom.jobStatus | titlecase}} · {{chatroom.jobDate | date:'MMM d, yyyy'}} · {{chatroom.jobTitle}}</p>
          </div>
        </div>
      }
      @if (hasMore()) {
        <div 
          appScrollSensor 
          (sensorInView)="onBottomReached()" 
          class="scroll-anchor">
          
          @if (isLoading()) {
            <th-loading type="skeleton" height="100%"></th-loading>
          }
        </div>
      }
    } @else {
      <th-empty-state 
        message="No chatrooms yet.">
      </th-empty-state>
    }
  </div>
</div>
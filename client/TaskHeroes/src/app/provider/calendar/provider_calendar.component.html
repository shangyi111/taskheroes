  <div class="calendar-container">
    <div class="header">
      <button (click)="previousMonth()">Previous</button>
      <h2>{{ currentMonth | date:'MMMM yyyy' }}</h2>
      <button (click)="nextMonth()">Next</button>
      <mat-icon class="settings-icon" (click)="openSettingsModal()">settings</mat-icon>
    </div>

    @if (showSettingsModal) {
    <div class="modal-overlay">
      <div class="modal-content">
        <h3>Calendar Settings</h3>
        <div class="form-group">
          <label for="availabilityWindow">Availability Window (days in advance):</label>
          <input id="availabilityWindow" type="number" [(ngModel)]="availabilityWindow" min="1">
        </div>
        <div class="modal-actions">
          <button class="save-btn" (click)="saveSettings()">Save</button>
          <button class="cancel-btn" (click)="closeSettingsModal()">Cancel</button>
        </div>
      </div>
    </div>
    }

    <div class="day-names">
      <div>Sun</div>
      <div>Mon</div>
      <div>Tue</div>
      <div>Wed</div>
      <div>Thu</div>
      <div>Fri</div>
      <div>Sat</div>
    </div>

    <div class="days-grid"
      (mouseleave)="endDrag()"
      (mouseup)="endDrag()"
    >
      @for (day of daysInMonth; track $index) {
        <div
          class="day"
          [class.disabled]="!day.isCurrentMonth"
          [class.selected]="day.isSelected"
          [class.available]="day.availability.isAvailable"
          [class.unavailable]="!day.availability.isAvailable"
          [class.past]="day.isPast"
          [class.booked]="day.availability.status === 'booked'"
          (mousedown)="startDrag(day)"
          (mouseenter)="onDrag(day)"
          (mouseup)="endDrag()"
        >
          @if (day.isCurrentMonth) {
            <span class="day-number">{{ day.date.getDate() }}</span>
            @if (day.availability.isAvailable) {
              <span class="price"  [class.past-price]="day.isPast">
                {{ day.availability.customPrice !== null ? (day.availability.customPrice | currency:'USD':'symbol':'1.0-0') : (basePrice | currency:'USD':'symbol':'1.0-0') }}
              </span>
            }
            @if (day.availability.status === 'booked') {
              <span class="status booked-status">Booked</span>
              <div class="tooltip">{{ day.availability.bookingInfo }}</div>
            }
            @if (!day.availability.isAvailable && day.availability.status !== 'booked') {
              <span class="status">X</span>
            }
          }
        </div>
      }
    </div>
  </div>

  @if (showModal) {
    <div class="modal-overlay">
      <div class="modal-content">
        <h3>Edit {{ selectedDates.length }} day@if (selectedDates.length > 1){s}</h3>
        <p class="date-range">
          {{ selectedDates.length > 0 ? (selectedDates[0] | date) : '' }} 
          @if (selectedDates.length > 1) {
            - {{ selectedDates[selectedDates.length - 1] | date }}
          }
        </p>

        <div class="form-group">
          <label for="bulkAvailability">Availability:</label>
          <select id="bulkAvailability" [(ngModel)]="bulkAvailability">
            <option [ngValue]="true">Available</option>
            <option [ngValue]="false">Unavailable</option>
          </select>
        </div>

        @if (bulkAvailability) {
          <div class="form-group">
            <label for="bulkPrice">Set Price:</label>
            <input id="bulkPrice" type="number" [(ngModel)]="bulkPrice" placeholder="e.g., {{ basePrice }}">
          </div>
        }
        
        <div class="modal-actions">
          <button class="save-btn" (click)="saveBulkChanges()">Save Changes</button>
          <button class="cancel-btn" (click)="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
  }